"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4335],{448:function(e,l,n){var t=n(85893),a=n(89090),i=n(21038),s=n(60990),o=n(52857),c=n(51423),d=n(44723),u=n(49986),r=n(51015),h=n(67294),x=n(64577);l.Z=e=>{let{url:l,data:n,setPostSuccess:p}=e,[y,g]=(0,h.useState)(null),m=!!y,j=()=>{g(null)},C=async e=>{let n=e.id;await (0,x.deleteData)("".concat(l),n),"function"==typeof p&&p(!0)},v=(0,h.useRef)(!0);return(0,h.useEffect)(()=>(v.current=!0,()=>{v.current=!1}),[]),(0,t.jsx)(i.Z,{title:"X\xf3a bản ghi?",children:(0,t.jsxs)(s.Z,{children:[(0,t.jsx)(o.Z,{"aria-describedby":null==n?void 0:n.id,className:"tableActionBtn deleteBtn",onClick:e=>{g(e.currentTarget)},"data-row-id":null==n?void 0:n.id,size:"small",children:(0,t.jsx)(a.Z,{})}),(0,t.jsx)(c.ZP,{id:m?null==n?void 0:n.id:void 0,open:m,anchorEl:y,onClose:j,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:(0,t.jsxs)(d.Z,{severity:"warning",children:["X\xf3a bản ghi n\xe0y ?",(0,t.jsx)(s.Z,{sx:{justifyContent:"center",paddingTop:4,width:"100%"},children:(0,t.jsxs)(u.Z,{variant:"outlined","aria-label":"outlined button group",children:[(0,t.jsx)(r.Z,{size:"small",onClick:()=>{y&&n&&C(n),g(null)},children:"Đ\xfang"}),(0,t.jsx)(r.Z,{color:"error",size:"small",onClick:j,children:"Hủy"})]})})]})})]})})}},34335:function(e,l,n){n.r(l),n.d(l,{default:function(){return M}});var t=n(85893),a=n(67294),i=n(68573),s=n(96788),o=n(93454),c=n(88539),d=n(60990),u=n(94395),r=n(39892),h=n(95587),x=n(448),p=n(64577),y=n(82431),g=n(17389),m=n(50720),j=n(27484),C=n.n(j),v=n(10586),Z=n(11163),f=n(27776),b=n(21773),P=n(68963),T=n(55201),D=n(53839),Q=n(65806),N=n(12166),w=n(97182),q=n(50333),_=n(40492),S=n(6897),Y=n(94143),F=n(29346),K=n(36307),k=n(84166),W=n(81873),z=n(15972),G=n(51015),H=n(96727),E=n(52857);let A={id:0,idCon:0,idGiayPhep:0,soQDTCQ:"",ngayKy:null,tongTienCQ:0,filePDF:null,ghiChu:null,fileUpload:null};var B=n(49051);let U=e=>{let{data:l,setPostSuccess:n,closeDialogs:s}=e,[o,c]=(0,a.useState)({id:(null==l?void 0:l.id)||0,idCon:(null==l?void 0:l.idCon)||0,idGiayPhep:(null==l?void 0:l.idGiayPhep)||0,soQDTCQ:(null==l?void 0:l.soQDTCQ)||null,ngayKy:C()(null==l?void 0:l.ngayKy)||null,tongTienCQ:(null==l?void 0:l.tongTienCQ)||null,filePDF:(null==l?void 0:l.filePDF)||null,ghiChu:(null==l?void 0:l.ghiChu)||null}),[d,u]=(0,a.useState)([]),[r,h]=(0,a.useState)([]),[x,y]=(0,a.useState)(),[j,f]=(0,a.useState)(!1),[T,D]=(0,a.useState)([]),[E,U]=(0,a.useState)(!1),[I,M]=(0,a.useState)(!1),L=(0,Z.useRouter)(),R=e=>l=>{let n="checkbox"===l.target.type?l.target.checked:l.target.value;c({...o,[e]:n})},[O]=(0,a.useState)({so_gp:null,cong_trinh:null,coquan_cp:null,loaihinh_cp:0,hieuluc_gp:null,loai_ct:0,tang_chuanuoc:0,huyen:0,xa:0,tieuvung_qh:0,tochuc_canhan:0,tu_nam:0,den_nam:0});(0,a.useEffect)(()=>{(async()=>{U(!0);try{var e;if((null===(e=L.query)||void 0===e?void 0:e.type)=="bo-cap"){let e=await (0,p.getData)("tien-cap-quyen/danh-sach/bo-cap");D(e);let l=await (0,p.getData)("giay-phep/danh-sach/",{...O,coquan_cp:"btnmt"});u(l)}else{let e=await (0,p.getData)("tien-cap-quyen/danh-sach/tinh-cap");D(e);let l=await (0,p.getData)("giay-phep/danh-sach/",{...O,coquan_cp:"ubndt"});u(l)}}catch(e){D([])}finally{U(!1)}})()},[O,L.query]);let V=async e=>{e.preventDefault(),(async()=>{var e,l,t,a,i,d;let u;u=(null===(e=L.query)||void 0===e?void 0:e.type)=="bo-cap"?"BTNMT":"UBNDT";let r={...o,coQuanCP:u,ngayKy:null===(l=o.ngayKy)||void 0===l?void 0:l.toDate(),filePDF:"pdf/tien-cap-quyen/".concat(u.toLowerCase(),"/").concat(null===(t=o.ngayKy)||void 0===t?void 0:t.year(),"/").concat(null===(a=o.soQDTCQ)||void 0===a?void 0:a.replace(/\//g,"_").toLowerCase(),".pdf")},h={filePath:"pdf/tien-cap-quyen/".concat(u.toLowerCase(),"/").concat(null===(i=r.ngayKy)||void 0===i?void 0:i.getFullYear()),fileName:"".concat(null===(d=o.soQDTCQ)||void 0===d?void 0:d.replace(/\//g,"_").toLowerCase(),".pdf"),file:x};M(!0);try{await (0,p.saveData)("tien-cap-quyen/luu",r)&&(await (0,p.uploadFile)(x,h.filePath,h.fileName),c(A),"function"==typeof n&&n(!0),s())}catch(e){console.log(e)}finally{M(!1)}})()},X=()=>{c({}),s()};return(0,t.jsxs)("form",{onSubmit:V,children:[(0,t.jsxs)(i.ZP,{container:!0,children:[(0,t.jsx)(i.ZP,{item:!0,xs:12,md:12,sx:{my:2},children:(0,t.jsx)(Q.Z,{label:"Quyết định bổ sung",onChange:()=>f(!j),control:(0,t.jsx)(N.Z,{checked:j})})}),j?(0,t.jsx)(i.ZP,{xs:12,md:12,sx:{my:2},children:E?(0,t.jsx)(w.Z,{size:20}):(0,t.jsx)(q.Z,{onChange:(e,l)=>c({...o,idCon:l.id}),size:"small",options:T,getOptionLabel:e=>e.soQDTCQ,renderInput:e=>(0,t.jsx)(_.Z,{...e,fullWidth:!0,label:"Chọn quyết định TCQ cần bổ xung"})})}):"",(0,t.jsx)(i.ZP,{item:!0,xs:12,md:12,sm:12,sx:{my:2},children:(0,t.jsxs)(S.Z,{sx:{m:1,width:550},children:[(0,t.jsx)(Y.Z,{children:"Chọn giấy ph\xe9p"}),(0,t.jsx)(F.Z,{multiple:!0,value:r,onChange:e=>h(e.target.value),input:(0,t.jsx)(K.Z,{label:"Chọn giấy ph\xe9p"}),renderValue:e=>(0,t.jsx)(k.Z,{gap:1,direction:"row",flexWrap:"wrap",children:e.map(e=>{let l=d.find(l=>l.id===e);return l?(0,t.jsx)(W.Z,{label:l.soGP},e):null})}),children:d.map(e=>(0,t.jsx)(z.Z,{value:e.id,content:e.soGP,children:e.soGP},e.id))})]})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,md:12,sx:{my:2},children:(0,t.jsx)(_.Z,{size:"small",type:"text",fullWidth:!0,label:"Số quyết định",placeholder:"",value:(null==o?void 0:o.soQDTCQ)||"",onChange:R("soQDTCQ")})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,md:12,sx:{my:2},children:(0,t.jsx)(m._,{dateAdapter:v.y,children:(0,t.jsx)(g.M,{label:"Ng\xe0y k\xfd",value:o.ngayKy||null,onChange:e=>c({...o,ngayKy:e}),slotProps:{textField:{size:"small",fullWidth:!0}},format:"DD/MM/YYYY"})})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,md:12,sx:{my:2},children:(0,t.jsx)(_.Z,{size:"small",type:"text",fullWidth:!0,label:"Tổng tiền",placeholder:"",value:(null==o?void 0:o.tongTienCQ)||0,onChange:R("tongTienCQ")})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,md:12,sx:{my:2},children:(0,t.jsxs)(G.Z,{className:"uploadBtn",component:"label",variant:"contained",startIcon:(0,t.jsx)(b.Z,{}),href:"#file-upload",children:["Upload file",(0,t.jsx)(B.b,{type:"file",onChange:e=>{var l;y((null===(l=e.target.files)||void 0===l?void 0:l[0])||null)},accept:".pdf"})]})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,md:12,sx:{my:2},children:(0,t.jsx)(_.Z,{size:"small",type:"text",fullWidth:!0,label:"Ghi ch\xfa",placeholder:"",value:(null==o?void 0:o.ghiChu)||"",onChange:R("ghiChu")})})]}),(0,t.jsxs)(H.Z,{sx:{p:0},children:[(0,t.jsx)(G.Z,{onClick:()=>X(),className:"btn cancleBtn",children:"Hủy"}),(0,t.jsxs)(G.Z,{type:"submit",disabled:I,className:"btn saveBtn",children:[" ",I?(0,t.jsx)(w.Z,{color:"inherit",size:20}):(0,t.jsx)(P.Z,{})," \xa0 Lưu"," "]})]})]})};var I=e=>{let{data:l,isEdit:n,setPostSuccess:a}=e,i=n?"Thay đổi th\xf4ng tin tiền cấp quyền":"Th\xeam tiền cấp quyền";return(0,t.jsx)(f.Z,{children:(e,s)=>(0,t.jsx)(d.Z,{children:n?(0,t.jsx)(E.Z,{onClick:()=>e((0,t.jsx)(U,{data:l,setPostSuccess:a,isEdit:n,closeDialogs:s}),i),children:(0,t.jsx)(T.Z,{className:"tableActionBtn"})}):(0,t.jsx)(G.Z,{variant:"outlined",size:"small",fullWidth:!0,color:"primary",startIcon:(0,t.jsx)(D.Z,{}),onClick:()=>e((0,t.jsx)(U,{data:l,setPostSuccess:a,isEdit:n,closeDialogs:s}),i),children:"Th\xeam mới"})})})},M=()=>{let[e,l]=(0,a.useState)(!1),n=()=>{l(e=>!e)},j=(0,Z.useRouter)(),[f,b]=(0,a.useState)([]),[P,T]=(0,a.useState)(!1),[D,Q]=(0,a.useState)(new Date),[N,w]=(0,a.useState)(new Date("".concat(new Date().getDate(),"-").concat(new Date().getMonth()+1,"-").concat(new Date().getFullYear()-5)));(0,a.useEffect)(()=>{(async()=>{T(!0);try{let e=await (0,p.getData)("tien-cap-quyen/danh-sach",{startYear:N?N.getFullYear():null,endYear:D?D.getFullYear():null,coquan_cp:"bo-cap"===j.query.type?"bo-cap":"tinh-cap"});b(e)}catch(e){b([])}finally{T(!1)}})()},[j.query.type,e,N,D]);let q=f.reduce((e,l)=>e+(l.tongTienCQ||0),0);return(0,t.jsxs)(i.ZP,{container:!0,spacing:3,children:[(0,t.jsxs)(i.ZP,{item:!0,xs:12,sm:12,md:12,className:"text-center",children:[(0,t.jsx)(s.Z,{className:"font-weight-bold",variant:"h6",children:"THỐNG K\xca"}),"bo-cap"===j.query.type?(0,t.jsx)(s.Z,{className:"font-weight-bold",variant:"h6",children:"KẾT QUẢ THU TIỀN CẤP QUYỀN KHAI TH\xc1C SỬ DỤNG NƯỚC CỦA C\xc1C C\xd4NG TR\xccNH DO BỘ CẤP PH\xc9P"}):"tinh-cap"===j.query.type?(0,t.jsx)(s.Z,{className:"font-weight-bold",variant:"h6",children:"KẾT QUẢ THU TIỀN CẤP QUYỀN KHAI TH\xc1C SỬ DỤNG NƯỚC CỦA C\xc1C C\xd4NG TR\xccNH DO TỈNH CẤP PH\xc9P"}):null]}),(0,t.jsx)(i.ZP,{item:!0,xs:12,sm:12,md:12,children:(0,t.jsxs)(s.Z,{children:["Tổng số tiền cấp quyền"," ",(null==N?void 0:N.getFullYear())===(null==D?void 0:D.getFullYear())?"năm ".concat(null==N?void 0:N.getFullYear()):"từ năm ".concat(null==N?void 0:N.getFullYear()," đến năm ").concat(null==D?void 0:D.getFullYear()),": \xa0",(0,u.ao)(q)]})}),(0,t.jsx)(i.ZP,{item:!0,xs:12,sm:12,md:12,children:(0,t.jsxs)(o.Z,{elevation:3,sx:{p:0,height:"100%"},children:[(0,t.jsx)(c.Z,{variant:"dense",children:(0,t.jsxs)(i.ZP,{container:!0,spacing:2,justifyContent:"end",children:[(0,t.jsx)(i.ZP,{item:!0,children:(0,t.jsx)(m._,{dateAdapter:v.y,children:(0,t.jsx)(g.M,{views:["year"],label:"Từ năm",value:C()(N),onChange:e=>{w(e?e.toDate():null)},slotProps:{textField:{size:"small",fullWidth:!0}},format:"YYYY"})})}),(0,t.jsx)(i.ZP,{item:!0,children:(0,t.jsx)(m._,{dateAdapter:v.y,children:(0,t.jsx)(g.M,{views:["year"],label:"Đến năm",value:C()(D),onChange:e=>{Q(e?e.toDate():null)},slotProps:{textField:{size:"small",fullWidth:!0}},format:"YYYY"})})}),(0,t.jsx)(i.ZP,{item:!0,children:(0,t.jsx)(y.Z,{tableId:"licensefee-data",filename:"TienCapQuyen"})}),(0,t.jsx)(i.ZP,{item:!0,children:(0,t.jsx)(I,{setPostSuccess:n,isEdit:!1})})]})}),(0,t.jsx)(r.Z,{id:"licensefee-data",columns:[{id:"stt",label:"STT",minWidth:90},{id:"soQDTCQ",label:"Quyết định cấp quyền",minWidth:250,pinned:"left",elm:e=>(0,t.jsx)("span",{children:(0,t.jsx)(h.Z,{name:null==e?void 0:e.soQDTCQ,src:null==e?void 0:e.filePDF})})},{id:"ngayKy",label:"Ng\xe0y k\xfd",minWidth:180,elm:e=>(0,u.p6)(e.ngayKy)},{id:"qd_bosung",label:"Quyết định bổ sung",minWidth:180,elm:e=>{var l,n;return(0,t.jsx)(h.Z,{name:null===(l=e.qd_bosung)||void 0===l?void 0:l.soQDTCQ,src:null===(n=e.qd_bosung)||void 0===n?void 0:n.filePDF})}},{id:"tongTienCQ",label:"Tổng số tiền cấp quyền(VNĐ)",elm:e=>(0,u.ao)(e.tongTienCQ)},{id:"ghiChu",minWidth:280,label:"Ghi ch\xfa"},{id:"so_gp",label:"Giấy ph\xe9p"},{id:"ten_ct",label:"C\xf4ng tr\xecnh",minWidth:150},{id:"actions",label:"Thao t\xe1c",pinned:"right"}],rows:f,loading:P,pagination:!0,actions:e=>(0,t.jsxs)(d.Z,{className:"group_btn",children:[(0,t.jsx)(I,{isEdit:!0,data:e,setPostSuccess:n}),(0,t.jsx)(x.Z,{url:"tien-cap-quyen",data:e,setPostSuccess:n})]})})]})})]})}}}]);