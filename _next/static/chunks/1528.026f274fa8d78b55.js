"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1528],{43096:function(e,t,n){n.d(t,{AI:function(){return j},kE:function(){return b}});var i=n(85893),o=n(67294),s=n(32342),r=n(84867),a=n(39153),c=n(5715),l=n(26467),d=n(60990),h=n(93454),x=n(97182),p=n(96788),g=n(45243),m=n.n(g);n(53183);var f=n(11163);let{BaseLayer:y}=s.LayersControl,u=e=>{var t,n;if(!e)return{color:"#3388ff",weight:3,opacity:.8,fillOpacity:.1};let i={"Đ\xea s\xf4ng":"#3388ff","Đ\xea biển":"#33bbff","Đ\xea cửa s\xf4ng":"#33aaff","Đ\xea bối":"#6699ff"},o={I:"#d62728",II:"#ff7f0e",III:"#2ca02c",IV:"#9467bd",V:"#8c564b","Đặc biệt":"#e377c2"},s=(null===(t=e.properties)||void 0===t?void 0:t.Loai_de)||"",r=(null===(n=e.properties)||void 0===n?void 0:n.Cap_de)||"";return{weight:3,color:r in o?o[r]:s in i?i[s]:"#3388ff",opacity:.8,fillOpacity:.1}},b=o.memo(e=>{let{data:t,style:n}=e,s=(0,o.useCallback)((e,t)=>{if(e.properties){let n=e.properties.Ten_KeLM||e.properties.Ten_doan||e.properties.Ten_tuyen||"K\xe8",i=e.properties.Thuoc_de||e.properties.Loai_de||"N/A",o="\n        <div>\n          <b>".concat(n,"</b><br/>\n          <small>Thuộc đ\xea: ").concat(i,"</small><br/>\n          <small>Cấp đ\xea: ").concat(e.properties.Cap_de||"N/A","</small><br/>\n          ").concat(e.properties.Chieu_dai?"<small>Chiều d\xe0i: ".concat(e.properties.Chieu_dai," m</small><br/>"):"","\n          ").concat(e.properties.Cao_trinh?"<small>Cao tr\xecnh: ".concat(e.properties.Cao_trinh," m</small>"):"","\n        </div>\n      ");t.bindPopup(o)}},[]);return(0,i.jsx)(r.Q,{data:t,style:n,onEachFeature:s,pointToLayer:(e,t)=>m().circleMarker(t,{radius:6,fillColor:"#ff6b6b",color:"#fff",weight:1,opacity:1,fillOpacity:.9})})},(e,t)=>e.data===t.data),j=e=>{let{geojsonData:t,markers:n=[],fitOnce:i=!0}=e,s=(0,a.Sx)(),r=o.useRef(!1);return(0,o.useEffect)(()=>{if(i&&r.current||!t||0===t.length)return;let e=m().latLngBounds([]);t.forEach(t=>{t&&t.features&&t.features.forEach(t=>{if(t.geometry&&t.geometry.coordinates){let n=t.geometry.coordinates;"LineString"===t.geometry.type?n.forEach(t=>{e.extend(m().latLng(t[1],t[0]))}):"MultiLineString"===t.geometry.type&&n.forEach(t=>{t.forEach(t=>{e.extend(m().latLng(t[1],t[0]))})})}})}),n&&n.length>0&&n.forEach(t=>{t.position&&e.extend(t.position)}),e.isValid()&&(s.fitBounds(e,{padding:[50,50]}),r.current=!0)},[s,t,n,i]),null},Z=()=>{let e=(0,a.Sx)(),[t]=o.useState({zoom:e.getZoom(),center:e.getCenter()}),n=o.useRef({zoom:t.zoom,center:t.center,isMoving:!1});return o.useEffect(()=>{let t=()=>{n.current={zoom:e.getZoom(),center:e.getCenter(),isMoving:!1}},i=()=>{n.current.isMoving=!0},o=()=>{n.current.isMoving=!1,t()};return e.on("zoomend",t),e.on("movestart",i),e.on("moveend",o),()=>{e.off("zoomend",t),e.off("movestart",i),e.off("moveend",o)}},[e]),o.useEffect(()=>{if(!n.current.isMoving){let{zoom:t,center:i}=n.current;e.getZoom()===t&&e.getCenter().equals(i)||e.setView(i,t,{animate:!1})}}),null},v={bingKey:"AuhiCJHlGzhg93IqUH_oCpl_-ZUrIE6SPftlyGYUvr9Amx5nzA-WqGcPquyFZl4L",mapCenter:[20.65,106.1],mapZoom:10,maxBounds:[[20.2,105.7],[21.09,106.8]]};t.ZP=e=>{let{children:t,config:n,onGeoJsonDataLoaded:r,extraLayers:a=[],loading:g}=e,m={...v,...n},[_,k]=(0,o.useState)([]),[I,C]=(0,o.useState)(!0),{basePath:w}=(0,f.useRouter)(),S=(0,o.useCallback)(async()=>{if(!(_.length>0)){C(!0);try{let e=["tbi_detw","hye_detw","tbi_dedp","hye_dedp",...a],t=(await Promise.all(e.map(async e=>{let t=await fetch("".concat(w,"/de_json/").concat(e,".geojson"));return t.ok?t.json():(console.error("Kh\xf4ng thể tải file ".concat(e,".geojson")),null)}))).filter(e=>null!==e);k(t),r&&r(t)}catch(e){console.error("Lỗi khi tải dữ liệu GeoJSON:",e)}finally{C(!1)}}},[a,r,_,w]);return(0,o.useEffect)(()=>{S()},[S]),(0,i.jsx)(d.Z,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:(0,i.jsxs)(h.Z,{elevation:3,sx:{flex:1,position:"relative",overflow:"hidden",borderRadius:"8px"},children:[(I||g)&&(0,i.jsxs)(d.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(255,255,255,0.7)",zIndex:1500},children:[(0,i.jsx)(x.Z,{color:"error"}),(0,i.jsx)(p.Z,{variant:"body2",sx:{ml:2},children:"Đang tải dữ liệu bản đồ..."})]}),(0,i.jsxs)(c.h,{center:m.mapCenter,zoom:m.mapZoom,maxBounds:m.maxBounds,maxBoundsViscosity:1,style:{height:"100%",width:"100%"},attributionControl:!1,children:[(0,i.jsxs)(s.LayersControl,{position:"bottomright",children:[(0,i.jsx)(y,{checked:!0,name:"Bản đồ h\xe0nh ch\xednh",children:(0,i.jsx)(l.I,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"})}),(0,i.jsx)(y,{name:"Bản đồ vệ tinh",children:(0,i.jsx)(l.I,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles \xa9 Esri"})}),(0,i.jsx)(y,{name:"Bản đồ nền x\xe1m",children:(0,i.jsx)(l.I,{url:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",attribution:"\xa9 CartoDB"})})]}),_[0]&&(0,i.jsx)(b,{data:_[0],style:u}),_[1]&&(0,i.jsx)(b,{data:_[1],style:u}),_[2]&&(0,i.jsx)(b,{data:_[2],style:u}),_[3]&&(0,i.jsx)(b,{data:_[3],style:u}),t,(0,i.jsx)(j,{geojsonData:_}),(0,i.jsx)(Z,{})]})]})})}},21528:function(e,t,n){n.r(t);var i=n(85893),o=n(67294),s=n(97762),r=n(20577),a=n(64049),c=n(60762),l=n(34375),d=n(52857),h=n(60990),x=n(96788),p=n(71919),g=n(47407),m=n(19304),f=n(32200),y=n(81873),u=n(56912),b=n(56894),j=n(65806),Z=n(12166),v=n(95639),_=n(37638),k=n(78233),I=n(48809),C=n(35783),w=n(45243),S=n.n(w),z=n(43096);let T=e=>S().divIcon({className:"incident-marker incident-".concat(e),html:"<div></div>",iconSize:S().point(20,20),iconAnchor:S().point(10,10),popupAnchor:S().point(0,-10)}),E=()=>{let e=s.renderToString((0,i.jsx)(I.Z,{sx:{color:"#0066cc",fontSize:20}}));return S().divIcon({className:"culvert-marker",html:'<div style="display: flex; align-items: center; justify-content: center;">'.concat(e,"</div>"),iconSize:[24,24],iconAnchor:[12,12]})},P=[{id:"sc1",name:"Sự cố sạt lở đ\xea Hữu Hồng",position:[20.716,106.416],status:"danger",description:"Sạt lở đ\xea K52+500, d\xe0i 15m, rộng 5m, s\xe2u 1.2m",date:"15/05/2023"},{id:"sc2",name:"Sự cố thấm đ\xea Hữu Luộc",position:[20.709,106.418],status:"warning",description:"Thấm đ\xea K36+200, thấm k\xe9o d\xe0i 20m",date:"22/04/2023"},{id:"sc3",name:"Sự cố nứt đ\xea Tả Tr\xe0 L\xfd",position:[20.705,106.394],status:"danger",description:"Nứt đ\xea K28+700, d\xe0i 5m, rộng 0.3m",date:"30/03/2023"},{id:"sc4",name:"Sự cố sụt l\xfan cống Việt H\xf9ng",position:[20.483,106.202],status:"warning",description:"Sụt l\xfan cống qua đ\xea bối Việt H\xf9ng, đường k\xednh 0.8m",date:"05/04/2023"},{id:"sc5",name:"Sự cố thấm đ\xea biển số 5",position:[20.477,106.225],status:"danger",description:"Thấm đ\xea biển K15+300, thấm k\xe9o d\xe0i 25m",date:"12/05/2023"}],L=()=>({weight:4,color:"#ff6b6b",opacity:.8,dashArray:"5, 10"}),A=e=>{let{incident:t,onClose:n}=e;if(!t)return null;let o="danger"===t.status?"#d32f2f":"#f57c00",s="danger"===t.status?_.Z:k.Z;return(0,i.jsxs)(c.Z,{sx:{position:"absolute",bottom:20,left:20,maxWidth:400,zIndex:1e3,opacity:0,transform:"translateY(20px)",animation:"slideIn 0.3s ease forwards","@keyframes slideIn":{"0%":{opacity:0,transform:"translateY(20px)"},"100%":{opacity:1,transform:"translateY(0)"}}},children:[(0,i.jsx)(l.Z,{action:(0,i.jsx)(d.Z,{onClick:n,children:(0,i.jsx)(v.Z,{})}),title:(0,i.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,i.jsx)(s,{sx:{color:o}}),(0,i.jsx)(x.Z,{variant:"subtitle1",sx:{color:o,fontWeight:"bold"},children:t.name})]})}),(0,i.jsx)(p.Z,{children:(0,i.jsxs)(g.Z,{children:[(0,i.jsx)(m.ZP,{sx:{"&:hover":{bgcolor:"action.hover",transition:"background-color 0.2s"},borderRadius:1},children:(0,i.jsx)(f.Z,{primary:"M\xf4 tả chi tiết",secondary:t.description,primaryTypographyProps:{variant:"caption",color:"text.secondary"},secondaryTypographyProps:{variant:"body2"}})}),(0,i.jsx)(m.ZP,{sx:{"&:hover":{bgcolor:"action.hover",transition:"background-color 0.2s"},borderRadius:1},children:(0,i.jsx)(f.Z,{primary:"Thời gian ph\xe1t hiện",secondary:t.date,primaryTypographyProps:{variant:"caption",color:"text.secondary"},secondaryTypographyProps:{variant:"body2"}})}),(0,i.jsx)(m.ZP,{sx:{"&:hover":{bgcolor:"action.hover",transition:"background-color 0.2s"},borderRadius:1},children:(0,i.jsx)(f.Z,{primary:"Mức độ nghi\xeam trọng",secondary:(0,i.jsx)(y.Z,{label:"danger"===t.status?"Nghi\xeam trọng":"Cần theo d\xf5i",color:"danger"===t.status?"error":"warning",size:"small",sx:{mt:.5}}),primaryTypographyProps:{variant:"caption",color:"text.secondary"}})}),(0,i.jsx)(m.ZP,{sx:{"&:hover":{bgcolor:"action.hover",transition:"background-color 0.2s"},borderRadius:1},children:(0,i.jsx)(f.Z,{primary:"Vị tr\xed (lat, lng)",secondary:"".concat(t.position[0].toFixed(5),", ").concat(t.position[1].toFixed(5)),primaryTypographyProps:{variant:"caption",color:"text.secondary"},secondaryTypographyProps:{variant:"body2"}})})]})})]})};t.default=()=>{let[e]=(0,o.useState)(P),[t,n]=(0,o.useState)([]),[s,c]=(0,o.useState)(!0),[l,d]=(0,o.useState)(null),[p,g]=(0,o.useState)({tbi_detw:!0,hye_detw:!0,tbi_dedp:!0,hye_dedp:!0,hye_cong:!0,tbi_ke:!0,hye_ke:!0,incidents:!0}),m=e=>{g(t=>({...t,[e]:!t[e]}))};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(h.Z,{sx:{position:"absolute",top:10,right:10,zIndex:1e3,bgcolor:"rgba(255,255,255,0.9)",p:1.5,borderRadius:"4px",maxWidth:"320px",maxHeight:"80%",overflow:"auto",boxShadow:"0 2px 10px rgba(0,0,0,0.1)"},children:[(0,i.jsx)(x.Z,{variant:"subtitle2",sx:{fontWeight:"bold",color:"#d32f2f",mb:1},children:"Th\xf4ng tin bản đồ sự cố c\xf4ng tr\xecnh"}),(0,i.jsxs)(x.Z,{variant:"caption",display:"block",sx:{mb:1},children:["• ",p.incidents?e.length:0," sự cố c\xf4ng tr\xecnh được hiển thị"]}),(0,i.jsx)(u.Z,{sx:{my:1}}),(0,i.jsx)(x.Z,{variant:"caption",sx:{fontWeight:"bold",display:"block",mb:.5,color:"#d32f2f"},children:"Ch\xfa th\xedch:"}),(0,i.jsxs)(b.Z,{sx:{mb:1},children:[(0,i.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(j.Z,{control:(0,i.jsx)(Z.Z,{size:"small",checked:p.tbi_detw||p.hye_detw,onChange:()=>{m("tbi_detw"),m("hye_detw")},sx:{color:"#d62728"}}),label:(0,i.jsx)(x.Z,{variant:"caption",children:"Đ\xea cấp I"})}),(0,i.jsx)(h.Z,{sx:{width:20,height:3,bgcolor:"#d62728",ml:-1}})]}),(0,i.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(j.Z,{control:(0,i.jsx)(Z.Z,{size:"small",checked:p.tbi_detw||p.hye_detw,onChange:()=>{m("tbi_detw"),m("hye_detw")},sx:{color:"#ff7f0e"}}),label:(0,i.jsx)(x.Z,{variant:"caption",children:"Đ\xea cấp II"})}),(0,i.jsx)(h.Z,{sx:{width:20,height:3,bgcolor:"#ff7f0e",ml:-1}})]}),(0,i.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(j.Z,{control:(0,i.jsx)(Z.Z,{size:"small",checked:p.tbi_dedp||p.hye_dedp,onChange:()=>{m("tbi_dedp"),m("hye_dedp")},sx:{color:"#2ca02c"}}),label:(0,i.jsx)(x.Z,{variant:"caption",children:"Đ\xea cấp III"})}),(0,i.jsx)(h.Z,{sx:{width:20,height:3,bgcolor:"#2ca02c",ml:-1}})]}),(0,i.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(j.Z,{control:(0,i.jsx)(Z.Z,{size:"small",checked:p.tbi_dedp||p.hye_dedp,onChange:()=>{m("tbi_dedp"),m("hye_dedp")},sx:{color:"#9467bd"}}),label:(0,i.jsx)(x.Z,{variant:"caption",children:"Đ\xea cấp IV"})}),(0,i.jsx)(h.Z,{sx:{width:20,height:3,bgcolor:"#9467bd",ml:-1}})]}),(0,i.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(j.Z,{control:(0,i.jsx)(Z.Z,{size:"small",checked:p.tbi_dedp||p.hye_dedp,onChange:()=>{m("tbi_dedp"),m("hye_dedp")},sx:{color:"#8c564b"}}),label:(0,i.jsx)(x.Z,{variant:"caption",children:"Đ\xea cấp V"})}),(0,i.jsx)(h.Z,{sx:{width:20,height:3,bgcolor:"#8c564b",ml:-1}})]}),(0,i.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(j.Z,{control:(0,i.jsx)(Z.Z,{size:"small",checked:p.incidents,onChange:()=>m("incidents"),sx:{color:"#f44336"}}),label:(0,i.jsx)(x.Z,{variant:"caption",children:"Sự cố c\xf4ng tr\xecnh"})}),(0,i.jsx)(h.Z,{className:"incident-marker",sx:{width:12,height:12,"& > div":{bgcolor:"#ff0000"}},children:(0,i.jsx)("div",{})})]}),(0,i.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(j.Z,{control:(0,i.jsx)(Z.Z,{size:"small",checked:p.hye_cong,onChange:()=>m("hye_cong"),sx:{color:"#0066cc"}}),label:(0,i.jsx)(x.Z,{variant:"caption",children:"Cống"})})," ",(0,i.jsx)(h.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20,ml:-1},children:(0,i.jsx)(I.Z,{sx:{color:"#0066cc",fontSize:16}})})]}),(0,i.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(j.Z,{control:(0,i.jsx)(Z.Z,{size:"small",checked:p.tbi_ke||p.hye_ke,onChange:()=>{m("tbi_ke"),m("hye_ke")},sx:{color:"#ff6b6b"}}),label:(0,i.jsx)(x.Z,{variant:"caption",children:"K\xe8 bảo vệ"})}),(0,i.jsx)(h.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20,ml:-1},children:(0,i.jsx)(C.Z,{sx:{color:"#ff6b6b",fontSize:16}})})]})]}),(0,i.jsx)(u.Z,{sx:{my:1}}),(0,i.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center",mb:1,alignContent:"center"},children:[(0,i.jsx)(h.Z,{className:"incident-marker",sx:{width:12,height:12,bgcolor:"#ff0000",borderRadius:"50%",mr:1,border:"2px solid white"}}),(0,i.jsx)(x.Z,{variant:"caption",children:"Sự cố nghi\xeam trọng"})]}),(0,i.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(h.Z,{className:"incident-marker",sx:{width:12,height:12,mr:1,"& > div":{bgcolor:"#ffaa00"}},children:(0,i.jsx)("div",{})}),(0,i.jsx)(x.Z,{variant:"caption",children:"Sự cố cần theo d\xf5i"})]})]}),(0,i.jsxs)(z.ZP,{onGeoJsonDataLoaded:e=>{n(e),c(!1)},loading:s,maxBounds:[[20.4,106],[21.05,107]],children:[t[4]&&p.hye_cong&&t[4].features.map(e=>(0,i.jsx)(r.J,{position:[e.geometry.coordinates[1],e.geometry.coordinates[0]],icon:E(),children:(0,i.jsx)(a.u,{direction:"top",offset:[0,-10],opacity:.9,children:(0,i.jsx)(x.Z,{variant:"caption",sx:{fontWeight:"bold"},children:e.properties.Ten_cong})})},e.properties.ID)),t[5]&&p.tbi_ke&&(0,i.jsx)(z.kE,{data:t[5],style:L}),t[6]&&p.hye_ke&&(0,i.jsx)(z.kE,{data:t[6],style:L}),t[7]&&p.hye_ke&&(0,i.jsx)(z.kE,{data:t[7],style:L}),t[8]&&p.tbi_ke&&(0,i.jsx)(z.kE,{data:t[8],style:L}),p.incidents&&e.map(e=>(0,i.jsx)(r.J,{position:e.position,icon:T(e.status),eventHandlers:{click:()=>d(e)},children:(0,i.jsx)(a.u,{direction:"top",offset:[0,-10],opacity:.9,children:(0,i.jsx)(x.Z,{variant:"caption",sx:{fontWeight:"bold"},children:e.name})})},e.id)),(0,i.jsx)(z.AI,{geojsonData:t,markers:e}),l&&(0,i.jsx)(A,{incident:l,onClose:()=>d(null)})]})]})}}}]);