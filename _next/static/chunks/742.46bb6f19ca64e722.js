"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[742],{38138:function(e,n,t){var r=t(85893),s=t(67294),a=t(75486),i=t(84166),l=t(88196),o=t(36795),c=t(88539),d=t(96788),u=t(51015),h=t(40110),m=t(95639);let x=s.forwardRef(function(e,n){return(0,r.jsx)(a.Z,{direction:"left",ref:n,...e})});n.Z=e=>{let{children:n}=e,[t,a]=(0,s.useState)(null),[g,p]=(0,s.useState)(null),[j,Z]=(0,s.useState)(!1),f=()=>{a(null),p(null),Z(!1)};return(0,r.jsxs)(i.Z,{children:[n((e,n)=>{a(e),p(n),Z(!0)},f),(0,r.jsx)(l.Z,{open:j,onClose:f,fullScreen:!0,TransitionComponent:x,sx:{zIndex:1201},children:t&&(0,r.jsxs)(i.Z,{children:[(0,r.jsx)(o.Z,{sx:{position:"relative"},children:(0,r.jsxs)(c.Z,{sx:{maxHeight:45,minHeight:45,position:"sticky",top:0},children:[(0,r.jsx)(d.Z,{sx:{ml:2,flex:1,color:"#fff"},variant:"h6",component:"div",children:g}),(0,r.jsx)(u.Z,{className:"btn closeBtn",sx:{p:2,mr:-2},onClick:f,children:(0,r.jsx)(m.Z,{})})]})}),(0,r.jsx)(h.Z,{children:t})]})})]})}},76598:function(e,n,t){t.d(n,{Z:function(){return a}});var r=t(67294),s=t(21565);let a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{pauseGlobalLoading:!0},[n,t]=(0,r.useState)(!1),{pauseGlobalLoading:a,resumeGlobalLoading:i}=(0,s.r)();return(0,r.useEffect)(()=>(e.pauseGlobalLoading&&a(),()=>{e.pauseGlobalLoading&&i()}),[e.pauseGlobalLoading,a,i]),{isSubmitting:n,submitForm:async e=>{t(!0);try{return await e()}finally{t(!1)}}}}},10742:function(e,n,t){t.r(n),t.d(n,{default:function(){return ez}});var r=t(85893),s=t(67294),a=t(60990),i=t(68573),l=t(96788),o=t(51015),c=t(52857),d=t(40492),u=t(97182),h=t(77527),m=t(60762),x=t(81873),g=t(95611),p=t(56912),j=t(35299),Z=t(34279),f=t(54453),y=t(54814),v=t(55158),b=t(23951),C=t(64563),w=t(98297),S=t(80986),N=t(39892),k=t(64577);let I=()=>{let[e,n]=(0,s.useState)([]),[t,r]=(0,s.useState)([]),[a,i]=(0,s.useState)([]),[l,o]=(0,s.useState)([]),[c,d]=(0,s.useState)([]),[u,h]=(0,s.useState)(!1),[m,x]=(0,s.useState)(!1),[g,p]=(0,s.useState)(!1),[j,Z]=(0,s.useState)(0),[f,y]=(0,s.useState)(0),[v,b]=(0,s.useState)(10),[C,w]=(0,s.useState)(""),[S,N]=(0,s.useState)({}),[I,T]=(0,s.useState)({}),[P,z]=(0,s.useState)([]),[A,W]=(0,s.useState)(""),[q,U]=(0,s.useState)(""),[F,L]=(0,s.useState)({}),[D,E]=(0,s.useState)(""),[B,K]=(0,s.useState)(""),[R,Q]=(0,s.useState)(!0),[V,H]=(0,s.useState)(!1),X=(0,s.useCallback)(async(e,t,r)=>{h(!0);try{void 0!==t&&t!==v&&b(t);let s=await k.authService.getUsers({pageNumber:(void 0!==e?e:f)+1,pageSize:void 0!==t?t:v,userName:void 0!==r?r:C||void 0});n(s.items),Z(s.totalItems)}catch(e){console.error("Failed to load users:",e)}finally{h(!1)}},[f,v,C]),O=(0,s.useCallback)(async()=>{try{let e=await k.authService.getRoles();r(e)}catch(e){console.error("Failed to load roles:",e)}},[]),M=(0,s.useCallback)(async()=>{try{let e=await k.authService.getDashboards();i(e)}catch(e){console.error("Failed to load dashboards:",e)}},[]),G=(0,s.useCallback)(async()=>{x(!0);try{let e=await k.congtrinhService.getUnlinkedConstructions();o(e)}catch(e){console.error("Failed to load constructions:",e)}finally{x(!1)}},[]),_=(0,s.useCallback)(async()=>{p(!0);try{let e=await k.tccnService.getUnlinkedBusinesses(!1);d(e)}catch(e){console.error("Failed to load businesses:",e)}finally{p(!1)}},[]),$=(0,s.useCallback)(async e=>{if(e)try{let n=(await k.authService.getDashboardsByUser(e)).map(e=>e.id);z(n)}catch(e){console.error("Failed to load user dashboards:",e)}},[]);(0,s.useEffect)(()=>{X(),O(),M(),G(),_()},[]);let J=async e=>{h(!0);try{let n=await k.authService.getUserById(e.id);n&&(T(n),n.userName&&await $(n.userName))}catch(e){console.error("Failed to get user details:",e)}finally{h(!1)}return!0},Y=async()=>{if(!q)return!1;h(!0);try{if(await k.authService.deleteUser(q))return X(),!0}catch(e){console.error("Failed to delete user:",e)}finally{h(!1)}return!1},ee=async()=>{if(!F.userName)return!1;let e={};if(D||(e.newPassword="Mật khẩu kh\xf4ng được để trống"),B?D!==B&&(e.confirmPassword="Mật khẩu x\xe1c nhận kh\xf4ng khớp"):e.confirmPassword="X\xe1c nhận mật khẩu kh\xf4ng được để trống",Object.keys(e).length>0)return N(e),!1;h(!0);try{if(await k.authService.setPassword(F.userName,D))return!0}catch(e){console.error("Failed to reset password:",e)}finally{h(!1)}return!1},en=async()=>{if(!I.userName||!A)return!1;h(!0);try{let e={username:I.userName,roleName:A};return await k.authService.assignRole(e),X(),!0}catch(e){console.error("Failed to assign role:",e)}finally{h(!1)}return!1},et=async()=>{if(!I.userName||!I.role)return!1;h(!0);try{let e={username:I.userName,roleName:I.role};return await k.authService.removeRole(e),X(),!0}catch(e){console.error("Failed to remove role:",e)}finally{h(!1)}return!1},er=async(e,n)=>{if(!I.userName)return!1;h(!0);try{let t={userName:I.userName,dashboardId:e};if((n?await k.authService.removeUserDashboardAccess(t):await k.authService.assignUserDashboardAccess(t))&&I.userName)return await $(I.userName),!0}catch(e){console.error("Failed to toggle dashboard access:",e)}finally{h(!1)}return!1},es=(e,n)=>{T(t=>({...t,[e]:n})),S[e]&&N(n=>{let t={...n};return delete t[e],t})},ea=()=>{var e,n,t;let r={};return(null===(e=I.userName)||void 0===e?void 0:e.trim())||(r.userName="T\xean đăng nhập kh\xf4ng được để trống"),I.id||((null===(t=I.password)||void 0===t?void 0:t.trim())?I.password!==I.confirmPassword&&(r.confirmPassword="Mật khẩu x\xe1c nhận kh\xf4ng khớp"):r.password="Mật khẩu kh\xf4ng được để trống"),(null===(n=I.fullName)||void 0===n?void 0:n.trim())||(r.fullName="Họ t\xean kh\xf4ng được để trống"),I.email&&!/\S+@\S+\.\S+/.test(I.email)&&(r.email="Email kh\xf4ng hợp lệ"),I.phoneNumber&&!/^[0-9]{10,11}$/.test(I.phoneNumber)&&(r.phoneNumber="Số điện thoại kh\xf4ng hợp lệ"),I.role||(r.role="Vui l\xf2ng chọn vai tr\xf2"),"Construction"!==I.role||I.id||I.constructionId||(r.constructionId="Vui l\xf2ng chọn c\xf4ng tr\xecnh"),"Business"!==I.role||I.id||I.businessId||(r.businessId="Vui l\xf2ng chọn tổ chức/c\xe1 nh\xe2n"),N(r),0===Object.keys(r).length},ei=async()=>{if(!ea())return!1;h(!0);try{let n=!1;if(I.id)n=await k.authService.updateUser(I.id,I);else{if((n=await k.authService.createUser(I))&&"Construction"===I.role&&I.constructionId)try{var e;let n=await k.dataTransmissionService.save({username:I.userName,password:I.password,ftpAddress:"222.255.134.6",protocol:"FTP",port:21,workingDirectory:"/".concat(null===(e=I.userName)||void 0===e?void 0:e.toUpperCase()),status:!1});console.log("DataTransmission account created:",n),await k.congtrinhService.setConstructionAccount(I.constructionId,I.userName||"")}catch(e){console.error("Failed to link user to construction or create data transmission account:",e)}if(n&&"Business"===I.role&&I.businessId&&I.userName)try{let e=await k.tccnService.getById(I.businessId);e&&(e.taiKhoan=I.userName,await k.tccnService.save(e,!1))}catch(e){console.error("Failed to link user to business:",e)}if(n&&I.userName&&I.role)try{await k.authService.assignRole({username:I.userName,roleName:I.role})}catch(e){console.error("Failed to assign role:",e)}}if(n)return X(),!0}catch(e){console.error("Failed to save user:",e)}finally{h(!1)}return!1},el=async(e,n)=>{if(!I.userName)return!1;h(!0);try{let t={username:I.userName,roleName:e};if(!await k.authService.removeRole(t))return console.error("Failed to remove old role"),!1;let r={username:I.userName,roleName:n};if(!await k.authService.assignRole(r))return console.error("Failed to assign new role"),await k.authService.assignRole(t),!1;if("Construction"===n){if(I.businessId)try{let e=await k.tccnService.getById(I.businessId);e&&e.taiKhoan===I.userName&&(e.taiKhoan=void 0,await k.tccnService.save(e,!1))}catch(e){console.error("Failed to clear business mapping:",e)}}else if("Business"===n&&I.constructionId)try{await k.congtrinhService.setConstructionAccount(I.constructionId,"")}catch(e){console.error("Failed to clear construction mapping:",e)}return T(e=>({...e,role:n})),await X(),!0}catch(e){console.error("Failed to change role:",e)}finally{h(!1)}return!1};return{users:e,roles:t,dashboards:a,constructions:l,businesses:c,loading:u,loadingConstructions:m,loadingBusinesses:g,page:f,setPage:y,pageSize:v,setPageSize:b,totalItems:j,currentUser:I,setCurrentUser:T,searchTerm:C,setSearchTerm:w,selectedRole:A,setSelectedRole:W,selectedDashboards:P,userIdToDelete:q,setUserIdToDelete:U,userToResetPassword:F,setUserToResetPassword:L,newPassword:D,setNewPassword:E,confirmPassword:B,setConfirmPassword:K,formErrors:S,setFormErrors:N,loadUsers:X,loadRoles:O,loadDashboards:M,loadConstructions:G,loadBusinesses:_,loadUserDashboards:$,handleEditUser:J,confirmDeleteUser:Y,confirmResetPassword:ee,handleAssignRole:en,handleRemoveRole:et,handleChangeRole:el,isChangingRole:V,setIsChangingRole:H,handleToggleDashboardAccess:er,handleFormChange:es,validateForm:ea,handleSaveUser:ei,handleAddUser:()=>(T({userName:"",password:"",confirmPassword:"",fullName:"",email:"",phoneNumber:"",role:"",constructionId:null,businessId:null}),N({}),!0),handleConstructionChange:e=>{if(T(n=>({...n,constructionId:e})),S.constructionId&&N(e=>{let n={...e};return delete n.constructionId,n}),R&&e){let n=l.find(n=>n.id===e);(null==n?void 0:n.maCT)&&es("userName",n.maCT)}},handleBusinessChange:e=>{T(n=>({...n,businessId:e})),S.businessId&&N(e=>{let n={...e};return delete n.businessId,n})},toggleAutoUsername:e=>{if(Q(e),e&&I.constructionId){let e=l.find(e=>e.id===I.constructionId);(null==e?void 0:e.maCT)&&es("userName",e.maCT)}},autoUsername:R,setAutoUsername:Q}};var T=t(88196),P=t(96727),z=t(40110),A=t(92365),W=e=>{let{open:n,onClose:t,onConfirm:s,title:a="X\xe1c nhận x\xf3a người d\xf9ng",contentText:i="Bạn c\xf3 chắc chắn muốn x\xf3a người d\xf9ng n\xe0y kh\xf4ng?",confirmButtonText:c="X\xf3a",cancelButtonText:d="Hủy"}=e;return(0,r.jsxs)(T.Z,{open:n,onClose:t,maxWidth:"xs",fullWidth:!0,children:[(0,r.jsx)(A.Z,{children:a}),(0,r.jsxs)(z.Z,{children:[(0,r.jsx)(l.Z,{children:i}),(0,r.jsx)(l.Z,{variant:"subtitle2",color:"error",sx:{mt:2},children:"H\xe0nh động n\xe0y kh\xf4ng thể ho\xe0n t\xe1c."})]}),(0,r.jsxs)(P.Z,{children:[(0,r.jsx)(o.Z,{onClick:t,children:d}),(0,r.jsx)(o.Z,{variant:"contained",color:"error",onClick:s,children:c})]})]})},q=t(84166),U=e=>{let{open:n,onClose:t,onConfirm:s,userName:a,newPassword:i,setNewPassword:c,confirmPassword:u,setConfirmPassword:h,errors:m}=e,x=async()=>{await s()&&t()};return(0,r.jsxs)(T.Z,{open:n,onClose:t,maxWidth:"xs",fullWidth:!0,children:[(0,r.jsx)(A.Z,{children:"Đặt lại mật khẩu"}),(0,r.jsx)(z.Z,{children:(0,r.jsxs)(q.Z,{spacing:3,sx:{mt:1},children:[(0,r.jsxs)(l.Z,{children:["Đặt lại mật khẩu cho t\xe0i khoản: ",(0,r.jsx)("strong",{children:a})]}),(0,r.jsx)(d.Z,{fullWidth:!0,label:"Mật khẩu mới",type:"password",value:i,onChange:e=>c(e.target.value),error:!!m.newPassword,helperText:m.newPassword,required:!0}),(0,r.jsx)(d.Z,{fullWidth:!0,label:"X\xe1c nhận mật khẩu",type:"password",value:u,onChange:e=>h(e.target.value),error:!!m.confirmPassword,helperText:m.confirmPassword,required:!0})]})}),(0,r.jsxs)(P.Z,{children:[(0,r.jsx)(o.Z,{onClick:t,children:"Hủy"}),(0,r.jsx)(o.Z,{variant:"contained",onClick:x,children:"Đặt lại mật khẩu"})]})]})},F=t(6897),L=t(94143),D=t(29346),E=t(15972),B=t(44723),K=t(29437),R=t(65806),Q=e=>{let{open:n,onClose:t,user:i,roles:c,selectedRole:d,setSelectedRole:h,onAssignRole:m,onRemoveRole:g,onChangeRole:j,isChangingRole:Z=!1,setIsChangingRole:f=()=>{}}=e,[y,v]=(0,s.useState)(null),[b,C]=(0,s.useState)(!1),w=async()=>{v(null),C(!0);try{await m()?t():v("Kh\xf4ng thể g\xe1n vai tr\xf2")}catch(e){v("Đ\xe3 xảy ra lỗi khi g\xe1n vai tr\xf2")}finally{C(!1)}},S=async()=>{v(null),C(!0);try{await g()?t():v("Kh\xf4ng thể x\xf3a vai tr\xf2")}catch(e){v("Đ\xe3 xảy ra lỗi khi x\xf3a vai tr\xf2")}finally{C(!1)}},N=async()=>{if(j&&i.role&&d){v(null),C(!0);try{await j(i.role,d)?(f(!1),t()):v("Kh\xf4ng thể thay đổi vai tr\xf2")}catch(e){v("Đ\xe3 xảy ra lỗi khi thay đổi vai tr\xf2")}finally{C(!1)}}};return(0,r.jsxs)(T.Z,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:[(0,r.jsx)(A.Z,{children:"Quản l\xfd vai tr\xf2 người d\xf9ng"}),(0,r.jsx)(z.Z,{children:(0,r.jsxs)(q.Z,{spacing:3,sx:{mt:1},children:[(0,r.jsxs)(l.Z,{children:["T\xe0i khoản: ",(0,r.jsx)("strong",{children:i.userName})]}),(0,r.jsx)(p.Z,{}),y&&(0,r.jsx)(B.Z,{severity:"error",children:y}),i.role?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsxs)(l.Z,{variant:"subtitle1",children:["Vai tr\xf2 hiện tại: ",(0,r.jsx)(x.Z,{label:i.role,color:"primary"})]}),(0,r.jsx)(R.Z,{control:(0,r.jsx)(K.Z,{checked:Z,onChange:()=>{f(!Z),!Z&&i.role&&h(i.role)}}),label:"Thay đổi vai tr\xf2"})]}),Z?(0,r.jsxs)(a.Z,{children:[(0,r.jsxs)(F.Z,{fullWidth:!0,sx:{mb:2},children:[(0,r.jsx)(L.Z,{id:"change-role-label",children:"Vai tr\xf2 mới"}),(0,r.jsx)(D.Z,{labelId:"change-role-label",value:d,label:"Vai tr\xf2 mới",onChange:e=>h(e.target.value),children:c.map(e=>(0,r.jsx)(E.Z,{value:e.name,disabled:e.name===i.role,children:e.name},e.id))})]}),(0,r.jsx)(o.Z,{variant:"contained",disabled:!d||d===i.role||b,onClick:N,fullWidth:!0,children:b?(0,r.jsx)(u.Z,{size:24,color:"inherit"}):"Cập nhật vai tr\xf2"})]}):(0,r.jsx)(o.Z,{variant:"outlined",color:"error",onClick:S,disabled:b,children:b?(0,r.jsx)(u.Z,{size:24,color:"inherit"}):"X\xf3a vai tr\xf2"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(F.Z,{fullWidth:!0,children:[(0,r.jsx)(L.Z,{id:"assign-role-label",children:"Chọn vai tr\xf2"}),(0,r.jsx)(D.Z,{labelId:"assign-role-label",value:d,label:"Chọn vai tr\xf2",onChange:e=>h(e.target.value),children:c.map(e=>(0,r.jsx)(E.Z,{value:e.name,children:e.name},e.id))})]}),(0,r.jsx)(o.Z,{variant:"contained",disabled:!d||b,onClick:w,children:b?(0,r.jsx)(u.Z,{size:24,color:"inherit"}):"G\xe1n vai tr\xf2"})]})]})}),(0,r.jsx)(P.Z,{children:(0,r.jsx)(o.Z,{onClick:t,disabled:b,children:"Đ\xf3ng"})})]})},V=e=>{let{open:n,onClose:t,user:s,dashboards:a,selectedDashboards:i,loading:c,onToggleAccess:d}=e;return(0,r.jsxs)(T.Z,{open:n,onClose:t,maxWidth:"md",fullWidth:!0,children:[(0,r.jsx)(A.Z,{children:"Quản l\xfd quyền truy cập"}),(0,r.jsx)(z.Z,{children:(0,r.jsxs)(q.Z,{spacing:3,sx:{mt:1},children:[(0,r.jsxs)(l.Z,{children:["T\xe0i khoản: ",(0,r.jsx)("strong",{children:s.userName})]}),(0,r.jsx)(p.Z,{}),(0,r.jsx)(l.Z,{variant:"subtitle1",children:"Danh s\xe1ch quyền truy cập:"}),a.length>0?(0,r.jsx)(N.Z,{rows:a,loading:c,id:"dashboards-table",pagination:!1,columns:[{id:"name",label:"T\xean chức năng",minWidth:180},{id:"access",label:"Quyền truy cập",minWidth:150,format:(e,n)=>{let t=i.includes(n.id);return(0,r.jsx)(x.Z,{label:t?"C\xf3 quyền":"Kh\xf4ng c\xf3 quyền",color:t?"success":"default",onClick:()=>d(n.id,t)})}}],noDataText:"Kh\xf4ng c\xf3 chức năng n\xe0o"}):(0,r.jsx)(l.Z,{color:"text.secondary",children:"Kh\xf4ng c\xf3 dữ liệu"})]})}),(0,r.jsx)(P.Z,{children:(0,r.jsx)(o.Z,{onClick:t,children:"Đ\xf3ng"})})]})},H=t(44513),X=t(28907),O=t(12283),M=t(50333),G=t(95639),_=t(86493),$=t(64970);let J=e=>{let{children:n,value:t,index:s,...i}=e;return(0,r.jsx)("div",{role:"tabpanel",hidden:t!==s,id:"user-tabpanel-".concat(s),"aria-labelledby":"user-tab-".concat(s),...i,children:t===s&&(0,r.jsx)(a.Z,{sx:{p:3},children:n})})};var Y=e=>{let{open:n,onClose:t,user:l,roles:h,constructions:m=[],businesses:x=[],loadingConstructions:g=!1,loadingBusinesses:p=!1,errors:j,onSave:Z,onFormChange:f,onConstructionChange:y,onBusinessChange:v,autoUsername:b=!0,onToggleAutoUsername:C}=e,[w,S]=(0,s.useState)(0),N=async()=>{await Z()&&t()};return(0,r.jsxs)(T.Z,{open:n,onClose:t,fullWidth:!0,maxWidth:"md",children:[(0,r.jsxs)(A.Z,{children:[l.id?"Cập nhật người d\xf9ng":"Th\xeam người d\xf9ng mới",(0,r.jsx)(c.Z,{onClick:t,sx:{position:"absolute",right:8,top:8},children:(0,r.jsx)(G.Z,{})})]}),(0,r.jsxs)(z.Z,{children:[(0,r.jsx)(a.Z,{sx:{width:"100%",mt:2},children:(0,r.jsx)(H.Z,{value:w,onChange:(e,n)=>{S(n)},"aria-label":"user management tabs",children:(0,r.jsx)(X.Z,{label:"Th\xf4ng tin cơ bản",icon:(0,r.jsx)(_.Z,{}),iconPosition:"start"})})}),(0,r.jsx)(J,{value:w,index:0,children:(0,r.jsxs)(i.ZP,{container:!0,spacing:3,children:[" ",(0,r.jsx)(i.ZP,{item:!0,xs:12,md:6,children:(0,r.jsx)(F.Z,{fullWidth:!0,error:!!j.userName,children:(0,r.jsx)(d.Z,{fullWidth:!0,label:"T\xean đăng nhập *",value:l.userName||"",onChange:e=>f("userName",e.target.value),disabled:!!l.id||"Construction"===l.role&&b,error:!!j.userName,helperText:j.userName,required:!0,InputProps:{startAdornment:(0,r.jsx)($.Z,{sx:{color:"action.active",mr:1}})}})})})," ",(0,r.jsx)(i.ZP,{item:!0,xs:12,md:6,children:(0,r.jsx)(F.Z,{fullWidth:!0,error:!!j.fullName,children:(0,r.jsx)(d.Z,{fullWidth:!0,label:"Họ t\xean *",value:l.fullName||"",onChange:e=>f("fullName",e.target.value),error:!!j.fullName,helperText:j.fullName,required:!0})})}),!l.id&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.ZP,{item:!0,xs:12,md:6,children:(0,r.jsx)(d.Z,{fullWidth:!0,label:"Mật khẩu",type:"password",value:l.password||"",onChange:e=>f("password",e.target.value),error:!!j.password,helperText:j.password,required:!0})}),(0,r.jsx)(i.ZP,{item:!0,xs:12,md:6,children:(0,r.jsx)(d.Z,{fullWidth:!0,label:"X\xe1c nhận mật khẩu",type:"password",value:l.confirmPassword||"",onChange:e=>f("confirmPassword",e.target.value),error:!!j.confirmPassword,helperText:j.confirmPassword,required:!0})})]})," ",(0,r.jsx)(i.ZP,{item:!0,xs:12,md:6,children:(0,r.jsx)(F.Z,{fullWidth:!0,error:!!j.email,children:(0,r.jsx)(d.Z,{fullWidth:!0,label:"Email",value:l.email||"",onChange:e=>f("email",e.target.value),error:!!j.email,helperText:j.email})})})," ",(0,r.jsx)(i.ZP,{item:!0,xs:12,md:6,children:(0,r.jsx)(F.Z,{fullWidth:!0,error:!!j.phoneNumber,children:(0,r.jsx)(d.Z,{fullWidth:!0,label:"Số điện thoại",value:l.phoneNumber||"",onChange:e=>f("phoneNumber",e.target.value),error:!!j.phoneNumber,helperText:j.phoneNumber})})}),(0,r.jsx)(i.ZP,{item:!0,xs:12,md:6,children:(0,r.jsxs)(F.Z,{fullWidth:!0,error:!!j.role,children:[(0,r.jsx)(L.Z,{id:"role-select-label",children:"Vai tr\xf2 *"}),(0,r.jsxs)(D.Z,{labelId:"role-select-label",value:l.role||"",label:"Vai tr\xf2 *",onChange:e=>f("role",e.target.value),disabled:!!l.id,children:[(0,r.jsx)(E.Z,{value:"",children:(0,r.jsx)("em",{children:"Chọn vai tr\xf2"})}),h.map(e=>(0,r.jsx)(E.Z,{value:e.name,children:e.name},e.id))]}),j.role&&(0,r.jsx)(O.Z,{children:j.role})]})}),"Construction"===l.role&&!l.id&&(0,r.jsx)(i.ZP,{item:!0,xs:12,md:6,children:(0,r.jsxs)(F.Z,{fullWidth:!0,error:!!j.constructionId,children:[(0,r.jsx)(M.Z,{id:"construction-select",options:m,getOptionLabel:e=>"".concat(e.tenCT," - ").concat(e.maCT||""),loading:g,value:m.find(e=>e.id===l.constructionId)||null,onChange:(e,n)=>{y&&y((null==n?void 0:n.id)||null)},renderInput:e=>(0,r.jsx)(d.Z,{...e,label:"C\xf4ng tr\xecnh *",placeholder:"T\xecm kiếm c\xf4ng tr\xecnh",error:!!j.constructionId,helperText:j.constructionId,InputProps:{...e.InputProps,endAdornment:(0,r.jsxs)(r.Fragment,{children:[g?(0,r.jsx)(u.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})}}),filterOptions:(e,n)=>{let{inputValue:t}=n,r=t.toLowerCase();return e.filter(e=>{var n,t,s;return(null===(n=e.tenCT)||void 0===n?void 0:n.toLowerCase().includes(r))||(null===(t=e.maCT)||void 0===t?void 0:t.toLowerCase().includes(r))||(null===(s=e.viTriCT)||void 0===s?void 0:s.toLowerCase().includes(r))})}}),(0,r.jsx)(a.Z,{sx:{mt:1},children:(0,r.jsx)(R.Z,{control:(0,r.jsx)(K.Z,{checked:b,onChange:()=>C&&C(!b),size:"small"}),label:"Tự động lấy t\xean đăng nhập từ m\xe3 c\xf4ng tr\xecnh"})})]})}),"Business"===l.role&&!l.id&&(0,r.jsx)(i.ZP,{item:!0,xs:12,md:6,children:(0,r.jsx)(F.Z,{fullWidth:!0,error:!!j.businessId,children:(0,r.jsx)(M.Z,{id:"business-select",options:x,getOptionLabel:e=>e.tenTCCN||"",loading:p,value:x.find(e=>e.id===l.businessId)||null,onChange:(e,n)=>{v&&v((null==n?void 0:n.id)||null)},renderInput:e=>(0,r.jsx)(d.Z,{...e,label:"Tổ chức/c\xe1 nh\xe2n *",placeholder:"T\xecm kiếm tổ chức/c\xe1 nh\xe2n",error:!!j.businessId,helperText:j.businessId,InputProps:{...e.InputProps,endAdornment:(0,r.jsxs)(r.Fragment,{children:[p?(0,r.jsx)(u.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})}}),filterOptions:(e,n)=>{let{inputValue:t}=n,r=t.toLowerCase();return e.filter(e=>{var n,t,s,a;return(null===(n=e.tenTCCN)||void 0===n?void 0:n.toLowerCase().includes(r))||(null===(t=e.diaChi)||void 0===t?void 0:t.toLowerCase().includes(r))||(null===(s=e.maSoThue)||void 0===s?void 0:s.toLowerCase().includes(r))||(null===(a=e.email)||void 0===a?void 0:a.toLowerCase().includes(r))})}})})})]})})]}),(0,r.jsxs)(P.Z,{children:[(0,r.jsx)(o.Z,{onClick:t,children:"Hủy"}),(0,r.jsx)(o.Z,{variant:"contained",onClick:N,children:l.id?"Cập nhật":"Th\xeam mới"})]})]})},ee=t(21038),en=t(93454),et=t(55895),er=t(24772),es=t(11825),ea=t(38855),ei=t(83947),el=t(60018),eo=t(38138),ec=t(13754),ed=t(76598);let eu=e=>{let{data:n}=e,[t,i]=(0,s.useState)([]),[o,h]=(0,s.useState)([]),[m,j]=(0,s.useState)(""),[Z,f]=(0,s.useState)(!1),[y,v]=(0,s.useState)(!1),[b,C]=(0,s.useState)({}),[w,S]=(0,s.useState)(null),[I,T]=(0,s.useState)(null),[P,z]=(0,s.useState)(!1),{submitForm:A}=(0,ed.Z)(),{success:W,error:U}=(0,ec.l)(),F=()=>{f(e=>!e)};(0,s.useEffect)(()=>{if(!m.trim()&&!P){h(t);return}let e=[...t];m.trim()&&(e=e.filter(e=>e.dashboardName.toLowerCase().includes(m.toLowerCase())||e.fileControl.toLowerCase().includes(m.toLowerCase()))),P&&(e=e.filter(e=>e.permitAccess)),h(e)},[m,P,t]);let L=(0,s.useCallback)(async()=>{try{v(!0),S(null),console.log("Fetching dashboards for user:",n.userName);let e=await k.authService.getDashboardsByUser(n.userName,!1);if(console.log("Received ".concat((null==e?void 0:e.length)||0," dashboards")),!e||!Array.isArray(e))throw Error("Dữ liệu trả về kh\xf4ng đ\xfang định dạng");i(e),h(e)}catch(n){console.error("Error fetching user dashboards:",n);let e=n.message||"Kh\xf4ng thể tải dữ liệu trang truy cập cho người d\xf9ng";S(e),U(e),i([]),h([])}finally{v(!1)}},[n.userName,U]);(0,s.useEffect)(()=>{L()},[L,Z]);let D=e=>async()=>{let t=e.permitAccess,r=e.id.toString(),s={id:e.id||0,userId:n.id,userName:n.userName,dashboardId:e.dashboardId,fileControl:e.fileControl,permitAccess:!t};C(e=>({...e,[r]:!0})),await A(async()=>{try{if(S(null),T(null),t){await k.authService.removeUserDashboardAccess(s,!1);let n="Đ\xe3 thu hồi quyền truy cập trực tiếp cho trang ".concat(e.dashboardName);T(n),W(n)}else{await k.authService.assignUserDashboardAccess(s,!1);let n="Đ\xe3 cấp quyền truy cập trực tiếp cho trang ".concat(e.dashboardName);T(n),W(n)}return i(n=>n.map(n=>n.id===e.id?{...n,permitAccess:!t}:n)),!0}catch(n){console.error("Error toggling user dashboard permission:",n);let e="Kh\xf4ng thể thay đổi quyền truy cập trang. Vui l\xf2ng thử lại sau.";return S(e),U(e),!1}finally{C(e=>({...e,[r]:!1})),I&&setTimeout(()=>T(null),3e3)}}),setTimeout(()=>{L(),F()},500)};return(0,r.jsxs)(a.Z,{sx:{p:2},children:[(0,r.jsx)(()=>{var e,s;return(0,r.jsx)(en.Z,{variant:"outlined",sx:{p:3,mb:3},children:(0,r.jsxs)(q.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",spacing:2,children:[(0,r.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(et.Z,{sx:{bgcolor:"primary.main"},children:(null===(s=n.userName)||void 0===s?void 0:null===(e=s.charAt(0))||void 0===e?void 0:e.toUpperCase())||"U"}),(0,r.jsxs)(a.Z,{children:[(0,r.jsxs)(l.Z,{variant:"h6",gutterBottom:!0,children:[n.fullName||n.userName,n.role&&(0,r.jsx)(x.Z,{size:"small",label:n.role,color:"primary",variant:"outlined",sx:{ml:1}})]}),(0,r.jsxs)(l.Z,{variant:"body2",color:"text.secondary",children:[n.email||"Kh\xf4ng c\xf3 email",n.phoneNumber&&" • ".concat(n.phoneNumber)]})]})]}),(0,r.jsx)(a.Z,{children:(0,r.jsx)(ee.Z,{title:"Quyền truy cập trang cho người d\xf9ng n\xe0y c\xf3 thể ghi đ\xe8 l\xean quyền của nh\xf3m người d\xf9ng",children:(0,r.jsx)(x.Z,{icon:(0,r.jsx)(er.Z,{fontSize:"small"}),label:"".concat(t.filter(e=>e.permitAccess).length,"/").concat(t.length," trang"),color:"primary"})})})]})})},{}),w&&(0,r.jsx)(B.Z,{severity:"error",sx:{mb:3},onClose:()=>S(null),children:w}),I&&(0,r.jsx)(B.Z,{severity:"success",sx:{mb:3},onClose:()=>T(null),children:I}),(0,r.jsxs)(a.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,flexWrap:"wrap",gap:2},children:[(0,r.jsx)(d.Z,{size:"small",placeholder:"T\xecm kiếm trang...",value:m,onChange:e=>j(e.target.value),InputProps:{startAdornment:(0,r.jsx)(g.Z,{position:"start",children:(0,r.jsx)(ea.Z,{fontSize:"small"})})},sx:{minWidth:{xs:"100%",sm:300}},autoComplete:"off"}),(0,r.jsxs)(a.Z,{sx:{display:"flex",gap:1},children:[(0,r.jsx)(ee.Z,{title:"Chỉ hiển thị trang đ\xe3 cấp quyền",children:(0,r.jsx)(R.Z,{control:(0,r.jsx)(K.Z,{checked:P,onChange:e=>z(e.target.checked),size:"small"}),label:"Đ\xe3 cấp quyền"})}),(0,r.jsx)(ee.Z,{title:"L\xe0m mới",children:(0,r.jsx)(c.Z,{onClick:()=>{L(),W("Dữ liệu đ\xe3 được cập nhật")},disabled:y,color:"primary",children:(0,r.jsx)(ei.Z,{})})})]})]}),(0,r.jsx)(p.Z,{sx:{mb:2}}),(0,r.jsxs)(B.Z,{severity:"info",sx:{mb:2},children:["Đ\xe2y l\xe0 quyền truy cập ",(0,r.jsx)("strong",{children:"trực tiếp"})," của người d\xf9ng tới c\xe1c trang. C\xe1c quyền n\xe0y được \xe1p dụng sau khi t\xednh to\xe1n quyền từ vai tr\xf2."]}),!y&&0===o.length&&(0,r.jsxs)(a.Z,{sx:{textAlign:"center",py:4},children:[(0,r.jsx)(l.Z,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"Kh\xf4ng c\xf3 dữ liệu trang truy cập"}),(0,r.jsxs)(l.Z,{variant:"caption",color:"text.secondary",children:["User ID: ",n.id,", User Name: ",n.userName]})]}),(0,r.jsx)(N.Z,{columns:[{id:"dashboardName",label:"T\xean trang",elm:e=>(0,r.jsx)(l.Z,{variant:"body1",fontWeight:500,children:e.dashboardName})},{id:"fileControl",label:"URL",elm:e=>(0,r.jsxs)(l.Z,{variant:"body2",sx:{display:"flex",alignItems:"center"},children:[(0,r.jsx)(es.Z,{fontSize:"small",color:"action",sx:{mr:.5}}),e.fileControl]})},{id:"permitAccess",label:"Truy cập",elm:e=>{let n=b[e.id.toString()],t=!!(null==e?void 0:e.permitAccess);return(0,r.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center"},children:n?(0,r.jsx)(u.Z,{size:24}):(0,r.jsx)(K.Z,{checked:t,onChange:D(e),color:t?"primary":"default",inputProps:{"aria-label":"toggle permission"}})})}}],loading:y,rows:o,pagination:!0})]})};var eh=e=>{let{data:n}=e,t="Ph\xe2n quyền truy cập trang - ".concat(n.userName);return(0,r.jsx)(eo.Z,{children:(e,s)=>(0,r.jsx)(c.Z,{color:"primary",onClick:()=>e((0,r.jsx)(eu,{data:n,closeDialogs:s}),t),children:(0,r.jsx)(ee.Z,{title:"Quản l\xfd quyền truy cập trang",children:(0,r.jsx)(el.Z,{fontSize:"small"})})})})},em=t(34375),ex=t(79533),eg=t(4291),ep=t(71919),ej=t(12166),eZ=t(44879),ef=t(89618),ey=t(39203),ev=t(95830),eb=t(73837),eC=t(85413),ew=t(89090),eS=t(12344);let eN=e=>{let{data:n}=e,[t,o]=(0,s.useState)([]),[h,j]=(0,s.useState)([]),[Z,f]=(0,s.useState)(!1),[y,v]=(0,s.useState)({}),[b,C]=(0,s.useState)(""),[w,S]=(0,s.useState)(null),[N,I]=(0,s.useState)(null),[T,P]=(0,s.useState)({}),{submitForm:z}=(0,ed.Z)(),{success:A,error:W}=(0,ec.l)(),U=e=>{P(n=>({...n,[e]:!n[e]}))};(0,s.useEffect)(()=>{if(!b.trim()){j(t);return}let e=t.filter(e=>e.name.toLowerCase().includes(b.toLowerCase())||e.path.toLowerCase().includes(b.toLowerCase())||e.functions.some(e=>e.permitName.toLowerCase().includes(b.toLowerCase())));if(b.trim()){let n={...T};e.forEach(e=>{n[e.id]=!0}),P(n)}j(e)},[b,t,T]);let F=(0,s.useCallback)(async()=>{try{f(!0),S(null);let e=await k.authService.getUserById(n.id);if(console.log("User details received:",e),!e||!e.userName)throw Error("Kh\xf4ng thể lấy th\xf4ng tin người d\xf9ng");if(e.dashboards&&Array.isArray(e.dashboards)){console.log("Using dashboards from user details:",e.dashboards.length);let n=e.dashboards.map(e=>({id:e.id,name:e.name||"",path:e.path||"",functions:Array.isArray(e.functions)?e.functions.map(e=>({id:e.id,permitName:e.permitName||"",permitCode:e.permitCode||"",status:!!e.status||!!e.isAllowed})):[]}));o(n),j(n);let t={};n.forEach(e=>{e.functions.some(e=>e.status)&&(t[e.id]=!0)}),P(t);return}console.log("Fetching dashboards for user:",e.userName);let t=await k.authService.getDashboardsByUser(e.userName,!1);if(console.log("Dashboards received:",t),t&&Array.isArray(t)&&t.length>0){let e=t.map(e=>({id:e.id,name:e.dashboardName||e.name||"",path:e.fileControl||e.path||"",functions:Array.isArray(e.functions)?e.functions.map(e=>({id:e.id,permitName:e.permitName||e.name||"",permitCode:e.permitCode||e.code||"",status:!!e.status||!!e.isAllowed})):[]}));o(e),j(e);let n={};e.forEach(e=>{e.functions.some(e=>e.status)&&(n[e.id]=!0)}),P(n)}else console.log("No dashboards found for user:",e.userName),o([]),j([])}catch(n){console.error("Error fetching user data:",n);let e=n.message||"Kh\xf4ng thể tải dữ liệu chức năng người d\xf9ng";S(e),W(e),o([]),j([])}finally{f(!1)}},[n.id,W]);(0,s.useEffect)(()=>{F()},[F]);let L=(e,t)=>async()=>{let r="".concat(t.id,"-").concat(e.id),s={userId:n.id,userName:n.userName,dashboardId:t.id,functionId:e.id,functionName:e.permitName,functionCode:e.permitCode};v(e=>({...e,[r]:!0})),await z(async()=>{try{if(S(null),I(null),e.status){await k.authService.deletePermission(s,!1);let n="Đ\xe3 thu hồi quyền ".concat(e.permitName," tr\xean trang ").concat(t.name);I(n),A(n)}else{await k.authService.savePermission(s,!1);let n="Đ\xe3 cấp quyền ".concat(e.permitName," tr\xean trang ").concat(t.name);I(n),A(n)}return o(n=>n.map(n=>n.id===t.id?{...n,functions:n.functions.map(n=>n.id===e.id?{...n,status:!n.status}:n)}:n)),!0}catch(n){console.error("Error toggling function permission:",n);let e="Kh\xf4ng thể thay đổi quyền chức năng";return S(e),W(e),!1}finally{v(e=>({...e,[r]:!1}))}}),setTimeout(()=>{F()},500)},D=(e,n)=>{L(e,n)()},E=(e,t)=>async()=>{var r,s;let a={...y};null===(r=e.functions)||void 0===r||r.forEach(n=>{a["".concat(e.id,"-").concat(n.id)]=!0}),v(a);try{S(null);let r=null===(s=e.functions)||void 0===s?void 0:s.filter(e=>e.status!==t);if(0===r.length){v(n=>{var t;let r={...n};return null===(t=e.functions)||void 0===t||t.forEach(n=>{delete r["".concat(e.id,"-").concat(n.id)]}),r});return}await Promise.all(r.map(async r=>{let s={userId:n.id,userName:n.userName,dashboardId:e.id,functionId:r.id,functionName:r.permitName,functionCode:r.permitCode};t?await k.authService.savePermission(s,!1):await k.authService.deletePermission(s,!1)})),o(n=>n.map(n=>n.id===e.id?{...n,functions:n.functions.map(e=>({...e,status:t}))}:n));let a="Đ\xe3 ".concat(t?"cấp":"thu hồi"," tất cả quyền tr\xean trang ").concat(e.name);I(a),A(a)}catch(n){console.error("Error updating multiple permissions:",n);let e="Kh\xf4ng thể cập nhật quyền h\xe0ng loạt";S(e),W(e)}finally{v(n=>{var t;let r={...n};return null===(t=e.functions)||void 0===t||t.forEach(n=>{delete r["".concat(e.id,"-").concat(n.id)]}),r}),setTimeout(()=>{F()},500)}};return(0,r.jsxs)(a.Z,{sx:{p:2},children:[(0,r.jsx)(()=>{var e,s;return(0,r.jsx)(en.Z,{variant:"outlined",sx:{p:3,mb:3},children:(0,r.jsxs)(q.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",spacing:2,children:[(0,r.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(et.Z,{sx:{bgcolor:"primary.main"},children:(null===(s=n.userName)||void 0===s?void 0:null===(e=s.charAt(0))||void 0===e?void 0:e.toUpperCase())||"U"}),(0,r.jsxs)(a.Z,{children:[(0,r.jsxs)(l.Z,{variant:"h6",gutterBottom:!0,children:[n.fullName||n.userName,n.role&&(0,r.jsx)(x.Z,{size:"small",label:n.role,color:"primary",variant:"outlined",sx:{ml:1}})]}),(0,r.jsxs)(l.Z,{variant:"body2",color:"text.secondary",children:[n.email||"Kh\xf4ng c\xf3 email",n.phoneNumber&&" • ".concat(n.phoneNumber)]})]})]}),(0,r.jsxs)(q.Z,{direction:"row",spacing:1,children:[(0,r.jsx)(x.Z,{icon:(0,r.jsx)(eZ.Z,{fontSize:"small"}),label:"".concat(t.length," trang"),color:"primary"}),(0,r.jsx)(x.Z,{icon:(0,r.jsx)(ef.Z,{fontSize:"small"}),label:"".concat(t.reduce((e,n)=>{var t;return e+(null===(t=n.functions)||void 0===t?void 0:t.filter(e=>e.status).length)},0)," quyền hoạt động"),color:"secondary"})]})]})})},{}),w&&(0,r.jsx)(B.Z,{severity:"error",sx:{mb:3},onClose:()=>S(null),children:w}),N&&(0,r.jsx)(B.Z,{severity:"success",sx:{mb:3},onClose:()=>I(null),children:N}),(0,r.jsxs)(a.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,r.jsx)(d.Z,{size:"small",placeholder:"T\xecm kiếm chức năng...",value:b,onChange:e=>C(e.target.value),InputProps:{startAdornment:(0,r.jsx)(g.Z,{position:"start",children:(0,r.jsx)(ea.Z,{fontSize:"small"})})},sx:{minWidth:{xs:"100%",sm:300}},autoComplete:"off"}),(0,r.jsx)(ee.Z,{title:"L\xe0m mới",children:(0,r.jsx)(c.Z,{onClick:()=>{F(),A("Dữ liệu đ\xe3 được cập nhật")},disabled:Z,color:"primary",children:(0,r.jsx)(ei.Z,{})})})]}),(0,r.jsx)(p.Z,{sx:{mb:3}}),Z&&(0,r.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",py:5},children:(0,r.jsx)(u.Z,{})}),!Z&&0===h.length&&(0,r.jsxs)(a.Z,{sx:{textAlign:"center",py:5},children:[(0,r.jsx)(ef.Z,{sx:{fontSize:"3rem",color:"text.secondary",opacity:.6,mb:2}}),(0,r.jsx)(l.Z,{variant:"h6",gutterBottom:!0,children:b?"Kh\xf4ng t\xecm thấy chức năng n\xe0o ph\xf9 hợp":"Người d\xf9ng chưa c\xf3 quyền truy cập trang n\xe0o"}),(0,r.jsx)(l.Z,{variant:"body2",color:"text.secondary",children:b?'Kh\xf4ng t\xecm thấy kết quả cho "'.concat(b,'"'):"H\xe3y cấp quyền truy cập trang trước khi cấp quyền chức năng"}),(0,r.jsx)(()=>(0,r.jsxs)(a.Z,{sx:{mt:2,p:2,bgcolor:"background.default",borderRadius:1},children:[(0,r.jsx)(l.Z,{variant:"subtitle2",color:"text.secondary",children:"Debug info:"}),(0,r.jsx)(l.Z,{variant:"caption",component:"pre",sx:{p:1,bgcolor:"background.paper",overflowX:"auto",whiteSpace:"pre-wrap"},children:"User ID: ".concat(n.id,"\nUser Name: ").concat(n.userName,"\nTotal dashboards: ").concat(t.length,'\nAPI calls:\n1. authService.getUserById("').concat(n.id,'")\n2. authService.getDashboardsByUser("').concat(n.userName,'")')})]}),{})]}),!Z&&h.map(e=>{var n,t,s;return(0,r.jsxs)(m.Z,{sx:{mb:2},children:[(0,r.jsx)(em.Z,{title:(0,r.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,r.jsx)(eZ.Z,{sx:{mr:1,color:"primary.main"}}),(0,r.jsxs)(l.Z,{variant:"h6",children:[e.name,(0,r.jsxs)(l.Z,{component:"span",variant:"caption",sx:{ml:1,color:"text.secondary"},children:["(ID: ",e.id,")"]})]})]}),subheader:(0,r.jsxs)(a.Z,{children:[(0,r.jsx)(l.Z,{variant:"body2",children:e.path}),(0,r.jsxs)(l.Z,{variant:"caption",color:"text.secondary",children:["Số chức năng: ",e.functions.length," | Đ\xe3 cấp: ",e.functions.filter(e=>e.status).length]})]}),action:(0,r.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(ex.Z,{badgeContent:null===(n=e.functions)||void 0===n?void 0:n.filter(e=>e.status).length,color:"primary",sx:{mr:1},children:(0,r.jsx)(x.Z,{size:"small",label:"Quyền hoạt động",color:(null===(t=e.functions)||void 0===t?void 0:t.some(e=>e.status))?"primary":"default",variant:"outlined"})}),(0,r.jsx)(ee.Z,{title:"Cấp tất cả quyền",children:(0,r.jsx)(c.Z,{size:"small",color:"primary",onClick:n=>{n.stopPropagation(),E(e,!0)()},children:(0,r.jsx)(ey.Z,{fontSize:"small"})})}),(0,r.jsx)(ee.Z,{title:"Thu hồi tất cả quyền",children:(0,r.jsx)(c.Z,{size:"small",color:"error",onClick:n=>{n.stopPropagation(),E(e,!1)()},children:(0,r.jsx)(ev.Z,{fontSize:"small"})})}),(0,r.jsx)(c.Z,{onClick:()=>U(e.id),children:T[e.id]?(0,r.jsx)(eb.Z,{}):(0,r.jsx)(eC.Z,{})})]}),onClick:()=>U(e.id),sx:{cursor:"pointer"}}),(0,r.jsx)(eg.Z,{in:T[e.id],timeout:"auto",unmountOnExit:!0,children:(0,r.jsxs)(ep.Z,{children:[(0,r.jsx)(l.Z,{variant:"subtitle2",gutterBottom:!0,children:"C\xe1c chức năng của trang:"}),(0,r.jsx)(i.ZP,{container:!0,spacing:2,children:null===(s=e.functions)||void 0===s?void 0:s.map(n=>{let t=!!y["".concat(e.id,"-").concat(n.id)];return(0,r.jsx)(i.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,r.jsxs)(en.Z,{variant:"outlined",sx:{p:1,display:"flex",justifyContent:"space-between",alignItems:"center",bgcolor:n.status?"action.selected":"background.paper",transition:"background-color 0.2s"},children:[(0,r.jsx)(R.Z,{control:t?(0,r.jsx)(u.Z,{size:20}):(0,r.jsx)(ej.Z,{checked:n.status,onChange:L(n,e),color:"primary"}),label:(0,r.jsxs)(a.Z,{children:[(0,r.jsx)(l.Z,{variant:"body2",fontWeight:n.status?"medium":"normal",children:n.permitName}),(0,r.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:n.permitCode})]})}),n.status&&(0,r.jsx)(ee.Z,{title:"X\xf3a quyền",children:(0,r.jsx)(c.Z,{size:"small",color:"error",onClick:()=>D(n,e),children:(0,r.jsx)(ew.Z,{fontSize:"small"})})})]})},n.id)})})]})})]},e.id)})]})};var ek=e=>{let{data:n,children:t}=e,a="Quản l\xfd quyền chức năng - ".concat(n.fullName||n.userName);return(0,r.jsx)(eo.Z,{children:(e,i)=>(0,r.jsx)(c.Z,{color:"primary",onClick:()=>e((0,r.jsx)(eN,{data:n,closeDialogs:i}),a),children:(0,r.jsx)(ee.Z,{title:"Quản l\xfd quyền truy cập chức năng",children:s.isValidElement(t)?t:(0,r.jsx)(eS.Z,{fontSize:"small"})})})})};let eI=(0,h.ZP)(a.Z)(e=>{let{theme:n}=e;return{padding:n.spacing(3),display:"flex",justifyContent:"space-between",alignItems:"center",[n.breakpoints.down("sm")]:{flexDirection:"column",alignItems:"flex-start",gap:n.spacing(2)}}}),eT=(0,h.ZP)(a.Z)(e=>{let{theme:n}=e;return{display:"flex",alignItems:"center",gap:n.spacing(2),[n.breakpoints.down("sm")]:{width:"100%"}}}),eP=(0,h.ZP)(a.Z)(e=>{let{theme:n}=e;return{display:"flex",alignItems:"center",gap:n.spacing(1),[n.breakpoints.down("sm")]:{marginTop:n.spacing(2)}}});var ez=()=>{let{users:e,roles:n,dashboards:t,constructions:h,businesses:k,loading:T,loadingConstructions:P,loadingBusinesses:z,setPage:A,page:q,totalItems:F,pageSize:L,currentUser:D,searchTerm:E,setSearchTerm:B,selectedRole:K,setSelectedRole:R,selectedDashboards:H,setUserIdToDelete:X,userToResetPassword:O,setUserToResetPassword:M,newPassword:G,setNewPassword:_,confirmPassword:$,setConfirmPassword:J,formErrors:en,autoUsername:et,loadUsers:er,handleEditUser:es,confirmDeleteUser:ea,confirmResetPassword:ei,handleAssignRole:el,handleRemoveRole:eo,handleChangeRole:ec,isChangingRole:ed,setIsChangingRole:eu,handleToggleDashboardAccess:em,handleFormChange:ex,handleSaveUser:eg,handleAddUser:ep,handleConstructionChange:ej,handleBusinessChange:eZ,toggleAutoUsername:ef}=I(),[ey,ev]=(0,s.useState)(!1),[eb,eC]=(0,s.useState)(!1),[ew,eS]=(0,s.useState)(!1),[eN,ez]=(0,s.useState)(!1),[eA,eW]=(0,s.useState)(!1),eq=async e=>{await es(e)&&ev(!0)},eU=e=>{X(e),eC(!0)},eF=async()=>{await ea()&&eC(!1)},eL=e=>{M(e),_(""),J(""),eS(!0)},eD=()=>{A(0),B(""),er()};return(0,r.jsxs)(m.Z,{children:[(0,r.jsxs)(i.ZP,{container:!0,spacing:6,children:[(0,r.jsxs)(i.ZP,{item:!0,xs:12,children:[(0,r.jsxs)(eI,{children:[(0,r.jsxs)(l.Z,{variant:"h6",sx:{display:"flex",alignItems:"center"},children:[(0,r.jsx)(w.Z,{sx:{mr:1}}),"Quản l\xfd người d\xf9ng",(0,r.jsx)(x.Z,{label:F||0,color:"primary",size:"small",sx:{ml:1}})]}),(0,r.jsxs)(eT,{children:[(0,r.jsx)(d.Z,{size:"small",placeholder:"T\xecm kiếm t\xe0i khoản...",value:E,onChange:e=>{B(e.target.value)},InputProps:{startAdornment:(0,r.jsx)(g.Z,{position:"start",children:(0,r.jsx)(j.Z,{fontSize:"small"})})},sx:{minWidth:250},autoComplete:"off"}),(0,r.jsxs)(eP,{children:[(0,r.jsx)(ee.Z,{title:"T\xecm kiếm",children:(0,r.jsx)(c.Z,{onClick:()=>{A(0),er()},color:"primary",disabled:T,children:(0,r.jsx)(j.Z,{})})}),(0,r.jsx)(ee.Z,{title:"L\xe0m mới",children:(0,r.jsx)(c.Z,{onClick:()=>eD(),color:"primary",disabled:T,children:(0,r.jsx)(S.Z,{})})}),(0,r.jsx)(o.Z,{variant:"contained",startIcon:(0,r.jsx)(C.Z,{}),onClick:()=>{ep()&&ev(!0)},size:"small",children:"Th\xeam người d\xf9ng"})]})]})]}),(0,r.jsx)(p.Z,{})]}),(0,r.jsx)(i.ZP,{item:!0,xs:12,children:(0,r.jsx)(N.Z,{rows:e,columns:[{id:"stt",label:"STT",align:"center",width:20},{id:"userName",label:"T\xean đăng nhập",width:150},{id:"fullName",label:"T\xean người d\xf9ng",width:300,maxWidth:300},{id:"email",label:"Email",width:250,maxWidth:250},{id:"phoneNumber",label:"Số điện thoại",width:120,maxWidth:120},{id:"actions",label:"Thao t\xe1c",width:200,maxWidth:200,align:"center"}],loading:T,pagination:!0,page:q,rowsPerPage:L,totalItems:F,onPageChange:e=>{A(e),er(e,L)},id:"user-table",actions:e=>(0,r.jsxs)(eP,{children:[(0,r.jsx)(ee.Z,{title:"Chỉnh sửa",children:(0,r.jsx)(c.Z,{size:"small",onClick:()=>eq(e),color:"primary",children:(0,r.jsx)(Z.Z,{fontSize:"small"})})}),(0,r.jsx)(ee.Z,{title:"Đặt lại mật khẩu",children:(0,r.jsx)(c.Z,{size:"small",onClick:()=>eL(e),color:"primary",children:(0,r.jsx)(y.Z,{fontSize:"small"})})}),(0,r.jsx)(ee.Z,{title:"Quản l\xfd vai tr\xf2",children:(0,r.jsx)(c.Z,{size:"small",color:"primary",children:(0,r.jsx)(v.Z,{fontSize:"small"})})}),(0,r.jsx)(eh,{data:e,onSuccess:eD}),(0,r.jsx)(ek,{data:e}),(0,r.jsx)(ee.Z,{title:"X\xf3a người d\xf9ng",children:(0,r.jsx)(c.Z,{size:"small",onClick:()=>eU(e.id),color:"error",children:(0,r.jsx)(f.Z,{fontSize:"small"})})})]}),noDataText:"Kh\xf4ng t\xecm thấy người d\xf9ng n\xe0o",noDataIcon:(0,r.jsx)(b.Z,{sx:{fontSize:64,color:"text.disabled"}})})})]}),(0,r.jsx)(Y,{open:ey,onClose:()=>ev(!1),user:D,roles:n,constructions:h,businesses:k,loadingConstructions:P,loadingBusinesses:z,errors:en,onSave:eg,onFormChange:ex,onConstructionChange:ej,onBusinessChange:eZ,autoUsername:et,onToggleAutoUsername:ef}),(0,r.jsx)(W,{open:eb,onClose:()=>eC(!1),onConfirm:eF}),(0,r.jsx)(U,{open:ew,onClose:()=>eS(!1),onConfirm:ei,userName:O.userName,newPassword:G,setNewPassword:_,confirmPassword:$,setConfirmPassword:J,errors:en}),(0,r.jsx)(Q,{open:eN,onClose:()=>ez(!1),user:D,roles:n,selectedRole:K,setSelectedRole:R,onAssignRole:el,onRemoveRole:eo,onChangeRole:ec,isChangingRole:ed,setIsChangingRole:eu}),(0,r.jsx)(V,{open:eA,onClose:()=>eW(!1),user:D,dashboards:t,selectedDashboards:H,loading:T,onToggleAccess:em}),T&&(0,r.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.3)",zIndex:9999},children:(0,r.jsx)(u.Z,{})})]})}}}]);